apiVersion: "extensions/v1beta1"
kind: Deployment
metadata:
  name: ubiquity-db
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: ubiquity-db
    spec:
      containers:
      - name: ubiquity-db
        image: UBIQUITY_DB_IMAGE
        ports:
        - containerPort: 5432
          name: ubiq-db-port  # no more then 15 chars
        env:
          - name: UBIQUITY_DB_USERNAME
            value: "ubiquity"
## Secret Set: for UBIQUITY_DB_USERNAME instead of the value above # TODO
#            valueFrom:
#              secretKeyRef:
#                name: ubiquity-db-credentials
#                key: username

          - name: UBIQUITY_DB_PASSWORD
            value: "ubiquity"
## Secret Set: for UBIQUITY_DB_PASSWORD instead of the value above # TODO
#            valueFrom:
#              secretKeyRef:
#                name: ubiquity-db-credentials
#                key: password

          - name: UBIQUITY_DB_NAME
            value: "ubiquity"
          - name: UBIQUITY_DB_CERT_PUBLIC  # path-to-public-key-file
# Cert #            value: "/var/lib/postgresql/ssl/private/ubiquity-db.crt"   # Certificate Set : use only if predefine certificate given
            value: ""   # for none Cert only
          - name: UBIQUITY_DB_CERT_PRIVATE # path-to-private-key-file
# Cert #            value: "/var/lib/postgresql/ssl/private/ubiquity-db.key"   # Certificate Set : use only if predefine certificate given
            value: ""   # for none Cert only


        volumeMounts:
          - name: ibm-ubiquity-db
            mountPath: "/var/lib/postgresql/data"
            subPath: "ibm-ubiquity"
# Certificate Set : use the below volumeMounts only if predefine certificate given
# Cert #          - name: ubiquity-db-private-certificate
# Cert #            mountPath: /var/lib/postgresql/ssl/private/
# Cert #            readOnly: true
      volumes:
        - name: ibm-ubiquity-db
          persistentVolumeClaim:
            claimName: ibm-ubiquity-db
# Certificate Set : use the below volumes only if predefine certificate given
# Cert #      - name: ubiquity-db-private-certificate
# Cert #          secret:
# Cert #            secretName: ubiquity-private-certificate
# Cert #            items:
# Cert #            - key: ubiquity-db.key
# Cert #              path: ubiquity-db.key
# Cert #            - key: ubiqutiy-db.crt
# Cert #              path: ubiqutiy-db.crt
